---
title: "New Cases in USA"
output: html_document
params:
  PS:
    label: "State or Province:"
    value: Alabama
    input: select
    choices: [Alabama, Alaska, American Samoa, Arizona, Arkansas, California, Colorado, Connecticut, Delaware, Diamond Princess, District of Columbia, Florida, Georgia, Grand Princess, Guam, Hawaii, Idaho, Illinois, Indiana, Iowa, Kansas, Kentucky, Louisiana, Maine, Maryland, Massachusetts, Michigan, Minnesota, Mississippi, Missouri, Montana, Nebraska, Nevada, New Hampshire, New Jersey, New Mexico, New York, North Carolina, North Dakota, Northern Mariana Islands, Ohio, Oklahoma, Oregon, Pennsylvania, Puerto Rico, Rhode Island, South Carolina, South Dakota, Tennessee, Texas, Utah, Vermont, Virgin Islands, Virginia, Washington, West Virginia, Wisconsin, Wyoming]
---

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
```

# Read in US Counts

```{r, message=FALSE}
g_counts <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>% 
  pivot_longer(cols = matches("^\\d"), names_to = "Date", values_to = "Cases") %>% 
  mutate(Date = mdy(Date)) %>% 
  group_by(Province_State, Date) %>% 
  summarise(state_count = sum(Cases)) %>% 
  mutate(new_cases = state_count - lag(state_count)) %>% 
  # Remove negative new_cases (likely reporting correction)
  filter(new_cases >= 0) %>% 
  filter(Date >= today() - months(12)) %>% 
  # Filter with parameters
  filter(Province_State == params$PS)
```

# Plot New Counts

```{r}
ggplot(g_counts, aes(x = Date, y = new_cases)) +
  geom_line(aes(color = Province_State)) +
  theme_minimal() +
  labs(y = "Number of New Cases",
       title = "New Cases of Covid-19 in the United States") +
  theme(
    legend.position = "none"
  )
```

